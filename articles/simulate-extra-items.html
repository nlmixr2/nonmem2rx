<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulate Derived Variables from imported NONMEM model • nonmem2rx</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate Derived Variables from imported NONMEM model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nonmem2rx</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.8</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-converting" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-arrow-right"></span> Converting</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-converting">
<li><a class="dropdown-item" href="../articles/import-nonmem.html">Converting NONMEM to rxode2 model</a></li>
    <li><a class="dropdown-item" href="../articles/convert-nlmixr2.html">Converting NONMEM to nlmixr2 object</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/rxode2-validate.html"><span class="fa fa-check"></span> Qualify</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-simulation" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fa-dice"></span> Simulation</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-simulation">
<li><a class="dropdown-item" href="../articles/simulate-new-dosing.html">New Dosing Scenarios</a></li>
    <li><a class="dropdown-item" href="../articles/simulate-uncertainty.html">Simulating with Uncertainty</a></li>
    <li><a class="dropdown-item" href="../articles/simulate-extra-items.html">Simulating with Derived Variables</a></li>
    <li><a class="dropdown-item" href="../articles/simulate-new-dosing-with-covs.html">Simulating with Covariates/Input PK parameters</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reporting" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reporting</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reporting">
<li><a class="dropdown-item" href="../articles/create-office.html">Creating word and powerpoint documents</a></li>
    <li><a class="dropdown-item" href="../articles/create-vpc.html">Easily create VPC plots</a></li>
    <li><a class="dropdown-item" href="../articles/create-augPred.html">Create enriched Individual plots</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/read-rounding.html"><span class="fa fa-bug"></span> Debug</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fas fa-rss"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nlmixr2/nonmem2rx/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Simulate Derived Variables from imported NONMEM model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/nonmem2rx/blob/v0.1.8/vignettes/articles/simulate-extra-items.Rmd" class="external-link"><code>vignettes/articles/simulate-extra-items.Rmd</code></a></small>
      <div class="d-none name"><code>simulate-extra-items.Rmd</code></div>
    </div>

    
    
<p>This page shows a simple work-flow for directly simulating a
different dosing paradigm with new derived items, in this case
<code>AUC</code>.</p>
<div class="section level2">
<h2 id="step-1-import-the-model">Step 1: Import the model<a class="anchor" aria-label="anchor" href="#step-1-import-the-model"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/nonmem2rx/" class="external-link">nonmem2rx</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/rxode2/" class="external-link">rxode2</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># First we need the location of the nonmem control stream Since we are running an example, we will use one of the built-in examples in `nonmem2rx`</span></span>
<span><span class="va">ctlFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"mods/cpt/runODE032.ctl"</span>, package<span class="op">=</span><span class="st">"nonmem2rx"</span><span class="op">)</span></span>
<span><span class="co"># You can use a control stream or other file. With the development</span></span>
<span><span class="co"># version of `babelmixr2`, you can simply point to the listing file</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nonmem2rx.html">nonmem2rx</a></span><span class="op">(</span><span class="va">ctlFile</span>, lst<span class="op">=</span><span class="st">".res"</span>, save<span class="op">=</span><span class="cn">FALSE</span>, determineError<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> getting information from  '/home/runner/work/_temp/Library/nonmem2rx/mods/cpt/runODE032.ctl'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading in xml file</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading in ext file</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading in phi file</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading in lst file</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> abbreviated list parsing</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading in grd file</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> splitting control stream by records</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $INPUT</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $MODEL</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $gTHETA</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $OMEGA</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $SIGMA</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $PROBLEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $DATA</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $SUBROUTINES</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $PK</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $DES</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $ERROR</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $ESTIMATION</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Ignore record $ESTIMATION</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $COVARIANCE</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Ignore record $COVARIANCE</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $TABLE</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta1` to `1.37034036528946`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta2` to `4.19814911033061`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta3` to `1.38003493562413`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta4` to `3.87657341967489`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta5` to `0.196446108190896`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `eta1` to `0.101251418415006`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `eta2` to `0.0993872449483344`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `eta3` to `0.101302674763154`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `eta4` to `0.0730497519364148`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> read in nonmem input data (for model validation): /home/runner/work/_temp/Library/nonmem2rx/mods/cpt/Bolus_2CPT.csv</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> ignoring lines that begin with a letter (IGNORE=@)'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> applying names specified by $INPUT</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> subsetting accept/ignore filters code: .data[-which((.data$SD == 0)),]</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> renaming 'ytype' to 'nmytype'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> read in nonmem IPRED data (for model validation): /home/runner/work/_temp/Library/nonmem2rx/mods/cpt/runODE032.csv</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> changing most variables to lower case</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> replace theta names</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> replace eta names</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done (no labels)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> renaming compartments</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> solving ipred problem</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> solving pred problem</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-2-add-auc-calculation">Step 2: Add AUC calculation<a class="anchor" aria-label="anchor" href="#step-2-add-auc-calculation"></a>
</h2>
<p>The concentration in this case is the <code>f</code> from the model,
a trick to get the <code>AUC</code> is to have an additional ODE
<code>d/dt(AUC) &lt;- f</code> and use some reset to get it per dosing
period.</p>
<p>However, this additional parameter is not part of the original model.
The calculation of AUC would depend on the number of observations in
your model, and for sparse data wouldn’t be terribly accurate.</p>
<p>One thing you can do is to use model piping append
<code>d/dt(AUC) &lt;- f</code> to the imported model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modAuc</span> <span class="op">&lt;-</span> <span class="va">mod</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/model.html" class="external-link">model</a></span><span class="op">(</span><span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">AUC</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">f</span>, append<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; → significant model change detected</span></span>
<span><span class="co">#&gt; → kept in model: '$atol', '$nonmemData', '$rtol', '$ssAtol', '$ssRtol'</span></span>
<span><span class="co">#&gt; → removed from model: '$digest', '$etaData', '$file', '$ipredAtol', '$ipredCompare', '$ipredData', '$ipredRtol', '$iwresAtol', '$iwresCompare', '$iwresRtol', '$notes', '$outputExtension', '$predAtol', '$predCompare', '$predData', '$predRtol', '$sigmaNames'</span></span>
<span></span>
<span><span class="va">modAuc</span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">rxode2-based free-form 3-cmt ODE model</span> <span style="color: #00BBBB;">──────────────────────────────────────</span> </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Initalization:</span> ──  </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Fixed Effects</span> (<span style="color: #0000BB; font-weight: bold;">$theta</span>): </span></span>
<span><span class="co">#&gt;    theta1    theta2    theta3    theta4       RSV </span></span>
<span><span class="co">#&gt; 1.3703404 4.1981491 1.3800349 3.8765734 0.1964461 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Omega</span> (<span style="color: #0000BB; font-weight: bold;">$omega</span>): </span></span>
<span><span class="co">#&gt;           eta1       eta2      eta3       eta4</span></span>
<span><span class="co">#&gt; eta1 0.1012514 0.00000000 0.0000000 0.00000000</span></span>
<span><span class="co">#&gt; eta2 0.0000000 0.09938724 0.0000000 0.00000000</span></span>
<span><span class="co">#&gt; eta3 0.0000000 0.00000000 0.1013027 0.00000000</span></span>
<span><span class="co">#&gt; eta4 0.0000000 0.00000000 0.0000000 0.07304975</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; States</span> (<span style="color: #0000BB; font-weight: bold;">$state</span> or <span style="color: #0000BB; font-weight: bold;">$stateDf</span>): </span></span>
<span><span class="co">#&gt;   Compartment Number Compartment Name</span></span>
<span><span class="co">#&gt; 1                  1          CENTRAL</span></span>
<span><span class="co">#&gt; 2                  2             PERI</span></span>
<span><span class="co">#&gt; 3                  3              AUC</span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">μ-referencing (</span><span style="color: #0000BB; font-weight: bold;">$muRefTable</span><span style="font-weight: bold;">):</span> ──  </span></span>
<span><span class="co">#&gt;    theta  eta level</span></span>
<span><span class="co">#&gt; 1 theta1 eta1    id</span></span>
<span><span class="co">#&gt; 2 theta2 eta2    id</span></span>
<span><span class="co">#&gt; 3 theta3 eta3    id</span></span>
<span><span class="co">#&gt; 4 theta4 eta4    id</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Model (Normalized Syntax):</span> ── </span></span>
<span><span class="co">#&gt; function() {</span></span>
<span><span class="co">#&gt;     description &lt;- "BOLUS_2CPT_CLV1QV2 SINGLE DOSE FOCEI (120 Ind/2280 Obs) runODE032"</span></span>
<span><span class="co">#&gt;     dfObs &lt;- 2280</span></span>
<span><span class="co">#&gt;     dfSub &lt;- 120</span></span>
<span><span class="co">#&gt;     sigma &lt;- lotri({</span></span>
<span><span class="co">#&gt;         eps1 ~ 1</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     thetaMat &lt;- lotri({</span></span>
<span><span class="co">#&gt;         theta1 ~ c(theta1 = 0.000887681)</span></span>
<span><span class="co">#&gt;         theta2 ~ c(theta1 = -0.00010551, theta2 = 0.000871409)</span></span>
<span><span class="co">#&gt;         theta3 ~ c(theta1 = 0.000184416, theta2 = -0.000106195, </span></span>
<span><span class="co">#&gt;             theta3 = 0.00299336)</span></span>
<span><span class="co">#&gt;         theta4 ~ c(theta1 = -0.000120234, theta2 = -5.06663e-05, </span></span>
<span><span class="co">#&gt;             theta3 = 0.000165252, theta4 = 0.00121347)</span></span>
<span><span class="co">#&gt;         RSV ~ c(theta1 = 5.2783e-08, theta2 = -1.56562e-05, theta3 = 5.99331e-06, </span></span>
<span><span class="co">#&gt;             theta4 = -2.53991e-05, RSV = 9.94218e-06)</span></span>
<span><span class="co">#&gt;         eps1 ~ c(theta1 = 0, theta2 = 0, theta3 = 0, theta4 = 0, </span></span>
<span><span class="co">#&gt;             RSV = 0, eps1 = 0)</span></span>
<span><span class="co">#&gt;         eta1 ~ c(theta1 = -4.71273e-05, theta2 = 4.69667e-05, </span></span>
<span><span class="co">#&gt;             theta3 = -3.64271e-05, theta4 = 2.54796e-05, RSV = -8.16885e-06, </span></span>
<span><span class="co">#&gt;             eps1 = 0, eta1 = 0.000169296)</span></span>
<span><span class="co">#&gt;         omega.2.1 ~ c(theta1 = 0, theta2 = 0, theta3 = 0, theta4 = 0, </span></span>
<span><span class="co">#&gt;             RSV = 0, eps1 = 0, eta1 = 0, omega.2.1 = 0)</span></span>
<span><span class="co">#&gt;         eta2 ~ c(theta1 = -7.37156e-05, theta2 = 2.56634e-05, </span></span>
<span><span class="co">#&gt;             theta3 = -8.08349e-05, theta4 = 1.37e-05, RSV = -4.36564e-06, </span></span>
<span><span class="co">#&gt;             eps1 = 0, eta1 = 8.75181e-06, omega.2.1 = 0, eta2 = 0.00015125)</span></span>
<span><span class="co">#&gt;         omega.3.1 ~ c(theta1 = 0, theta2 = 0, theta3 = 0, theta4 = 0, </span></span>
<span><span class="co">#&gt;             RSV = 0, eps1 = 0, eta1 = 0, omega.2.1 = 0, eta2 = 0, </span></span>
<span><span class="co">#&gt;             omega.3.1 = 0)</span></span>
<span><span class="co">#&gt;         omega.3.2 ~ c(theta1 = 0, theta2 = 0, theta3 = 0, theta4 = 0, </span></span>
<span><span class="co">#&gt;             RSV = 0, eps1 = 0, eta1 = 0, omega.2.1 = 0, eta2 = 0, </span></span>
<span><span class="co">#&gt;             omega.3.1 = 0, omega.3.2 = 0)</span></span>
<span><span class="co">#&gt;         eta3 ~ c(theta1 = 6.63383e-05, theta2 = -8.19002e-05, </span></span>
<span><span class="co">#&gt;             theta3 = 0.000548985, theta4 = 0.000168356, RSV = 1.59122e-06, </span></span>
<span><span class="co">#&gt;             eps1 = 0, eta1 = 3.48714e-05, omega.2.1 = 0, eta2 = 4.31593e-07, </span></span>
<span><span class="co">#&gt;             omega.3.1 = 0, omega.3.2 = 0, eta3 = 0.000959029)</span></span>
<span><span class="co">#&gt;         omega.4.1 ~ c(theta1 = 0, theta2 = 0, theta3 = 0, theta4 = 0, </span></span>
<span><span class="co">#&gt;             RSV = 0, eps1 = 0, eta1 = 0, omega.2.1 = 0, eta2 = 0, </span></span>
<span><span class="co">#&gt;             omega.3.1 = 0, omega.3.2 = 0, eta3 = 0, omega.4.1 = 0)</span></span>
<span><span class="co">#&gt;         omega.4.2 ~ c(theta1 = 0, theta2 = 0, theta3 = 0, theta4 = 0, </span></span>
<span><span class="co">#&gt;             RSV = 0, eps1 = 0, eta1 = 0, omega.2.1 = 0, eta2 = 0, </span></span>
<span><span class="co">#&gt;             omega.3.1 = 0, omega.3.2 = 0, eta3 = 0, omega.4.1 = 0, </span></span>
<span><span class="co">#&gt;             omega.4.2 = 0)</span></span>
<span><span class="co">#&gt;         omega.4.3 ~ c(theta1 = 0, theta2 = 0, theta3 = 0, theta4 = 0, </span></span>
<span><span class="co">#&gt;             RSV = 0, eps1 = 0, eta1 = 0, omega.2.1 = 0, eta2 = 0, </span></span>
<span><span class="co">#&gt;             omega.3.1 = 0, omega.3.2 = 0, eta3 = 0, omega.4.1 = 0, </span></span>
<span><span class="co">#&gt;             omega.4.2 = 0, omega.4.3 = 0)</span></span>
<span><span class="co">#&gt;         eta4 ~ c(theta1 = -9.49661e-06, theta2 = 0.000110108, </span></span>
<span><span class="co">#&gt;             theta3 = -0.000306537, theta4 = -9.12897e-05, RSV = 3.1877e-06, </span></span>
<span><span class="co">#&gt;             eps1 = 0, eta1 = 1.36628e-05, omega.2.1 = 0, eta2 = -1.95096e-05, </span></span>
<span><span class="co">#&gt;             omega.3.1 = 0, omega.3.2 = 0, eta3 = -0.00012977, </span></span>
<span><span class="co">#&gt;             omega.4.1 = 0, omega.4.2 = 0, omega.4.3 = 0, eta4 = 0.00051019)</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     validation &lt;- c("IPRED relative difference compared to Nonmem IPRED: 0%; 95% percentile: (0%,0%); rtol=6.43e-06", </span></span>
<span><span class="co">#&gt;         "IPRED absolute difference compared to Nonmem IPRED: 95% percentile: (2.19e-05, 0.0418); atol=0.00167", </span></span>
<span><span class="co">#&gt;         "IWRES relative difference compared to Nonmem IWRES: 0%; 95% percentile: (0%,0.01%); rtol=8.99e-06", </span></span>
<span><span class="co">#&gt;         "IWRES absolute difference compared to Nonmem IWRES: 95% percentile: (1.82e-07, 4.63e-05); atol=3.65e-06", </span></span>
<span><span class="co">#&gt;         "PRED relative difference compared to Nonmem PRED: 0%; 95% percentile: (0%,0%); rtol=6.41e-06", </span></span>
<span><span class="co">#&gt;         "PRED absolute difference compared to Nonmem PRED: 95% percentile: (1.41e-07,0.00382) atol=6.41e-06")</span></span>
<span><span class="co">#&gt;     ini({</span></span>
<span><span class="co">#&gt;         theta1 &lt;- 1.37034036528946</span></span>
<span><span class="co">#&gt;         label("log Cl")</span></span>
<span><span class="co">#&gt;         theta2 &lt;- 4.19814911033061</span></span>
<span><span class="co">#&gt;         label("log Vc")</span></span>
<span><span class="co">#&gt;         theta3 &lt;- 1.38003493562413</span></span>
<span><span class="co">#&gt;         label("log Q")</span></span>
<span><span class="co">#&gt;         theta4 &lt;- 3.87657341967489</span></span>
<span><span class="co">#&gt;         label("log Vp")</span></span>
<span><span class="co">#&gt;         RSV &lt;- c(0, 0.196446108190896, 1)</span></span>
<span><span class="co">#&gt;         label("RSV")</span></span>
<span><span class="co">#&gt;         eta1 ~ 0.101251418415006</span></span>
<span><span class="co">#&gt;         eta2 ~ 0.0993872449483344</span></span>
<span><span class="co">#&gt;         eta3 ~ 0.101302674763154</span></span>
<span><span class="co">#&gt;         eta4 ~ 0.0730497519364148</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     model({</span></span>
<span><span class="co">#&gt;         cmt(CENTRAL)</span></span>
<span><span class="co">#&gt;         cmt(PERI)</span></span>
<span><span class="co">#&gt;         cl &lt;- exp(theta1 + eta1)</span></span>
<span><span class="co">#&gt;         v &lt;- exp(theta2 + eta2)</span></span>
<span><span class="co">#&gt;         q &lt;- exp(theta3 + eta3)</span></span>
<span><span class="co">#&gt;         v2 &lt;- exp(theta4 + eta4)</span></span>
<span><span class="co">#&gt;         v1 &lt;- v</span></span>
<span><span class="co">#&gt;         scale1 &lt;- v</span></span>
<span><span class="co">#&gt;         k21 &lt;- q/v2</span></span>
<span><span class="co">#&gt;         k12 &lt;- q/v</span></span>
<span><span class="co">#&gt;         d/dt(CENTRAL) &lt;- k21 * PERI - k12 * CENTRAL - cl * CENTRAL/v1</span></span>
<span><span class="co">#&gt;         d/dt(PERI) &lt;- -k21 * PERI + k12 * CENTRAL</span></span>
<span><span class="co">#&gt;         f &lt;- CENTRAL/scale1</span></span>
<span><span class="co">#&gt;         ipred &lt;- f</span></span>
<span><span class="co">#&gt;         rescv &lt;- RSV</span></span>
<span><span class="co">#&gt;         w &lt;- ipred * rescv</span></span>
<span><span class="co">#&gt;         ires &lt;- DV - ipred</span></span>
<span><span class="co">#&gt;         iwres &lt;- ires/w</span></span>
<span><span class="co">#&gt;         y &lt;- ipred + w * eps1</span></span>
<span><span class="co">#&gt;         d/dt(AUC) &lt;- f</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">nonmem2rx extra properties:</span> ──  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Sigma</span> (<span style="color: #0000BB; font-weight: bold;">$sigma</span>): </span></span>
<span><span class="co">#&gt;      eps1</span></span>
<span><span class="co">#&gt; eps1    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other properties include: <span style="color: #0000BB; font-weight: bold;">$nonmemData</span></span></span>
<span><span class="co">#&gt; captured NONMEM table outputs: </span></span>
<span><span class="co">#&gt; NONMEM/rxode2 comparison data: <span style="color: #0000BB; font-weight: bold;">$iwresCompare</span>, <span style="color: #0000BB; font-weight: bold;">$predCompare</span>, <span style="color: #0000BB; font-weight: bold;">$ipredCompare</span></span></span>
<span><span class="co">#&gt; NONMEM/rxode2 composite comparison: <span style="color: #0000BB; font-weight: bold;">$predAtol</span>, <span style="color: #0000BB; font-weight: bold;">$predRtol</span>, <span style="color: #0000BB; font-weight: bold;">$ipredAtol</span>, <span style="color: #0000BB; font-weight: bold;">$ipredRtol</span>, <span style="color: #0000BB; font-weight: bold;">$iwresAtol</span>, <span style="color: #0000BB; font-weight: bold;">$iwresRtol</span></span></span></code></pre></div>
<p>You can also use <code>append=NA</code> to pre-pend or
<code>append=f</code> to put the ODE right after the <code>f</code> line
in the model.</p>
</div>
<div class="section level2">
<h2 id="step-3-setup-event-table-to-calculate-the-auc-for-a-different-dosing-paradigm">Step 3: Setup event table to calculate the AUC for a different
dosing paradigm:<a class="anchor" aria-label="anchor" href="#step-3-setup-event-table-to-calculate-the-auc-for-a-different-dosing-paradigm"></a>
</h2>
<p>Lets say that in this case instead of a single dose, we want to see
what the concentration profile is with a single day of BID dosing. In
this case is done by creating a <a href="https://nlmixr2.github.io/rxode2/articles/rxode2-event-table.html" class="external-link">quick
event table</a>.</p>
<p>In this case since we are also wanting <code>AUC</code> per dosing
period, you can add a reset dose to the <code>AUC</code> compartment
every time a dose is given (so it will only track the AUC of the current
dose):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/et.html" class="external-link">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">120000</span>, ii<span class="op">=</span><span class="fl">12</span>, until<span class="op">=</span><span class="fl">24</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/et.html" class="external-link">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">0</span>, ii<span class="op">=</span><span class="fl">12</span>, until<span class="op">=</span><span class="fl">24</span>, cmt<span class="op">=</span><span class="st">"AUC"</span>, evid<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># replace AUC with zero at dosing</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/et.html" class="external-link">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">8</span>, <span class="fl">11.999</span>, <span class="fl">12</span>, <span class="fl">12.01</span>, <span class="fl">14</span>, <span class="fl">20</span>, <span class="fl">23.999</span>, <span class="fl">24</span>, <span class="fl">24.001</span>, <span class="fl">28</span>, <span class="fl">32</span>, <span class="fl">36</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/et.html" class="external-link">et</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-4-solve-using-rxode2">Step 4: Solve using <code>rxode2</code><a class="anchor" aria-label="anchor" href="#step-4-solve-using-rxode2"></a>
</h2>
<p>In this step, we solve the model with the new event table for the 10
subjects:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">modAuc</span>, <span class="va">ev</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using nocb interpolation like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using addlKeepsCov=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using addlDropSs=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using ssAtDoseTime=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using safeZero=FALSE since NONMEM does not use protection by default</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using safePow=FALSE since NONMEM does not use protection by default</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using safeLog=FALSE since NONMEM does not use protection by default</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using ss2cancelAllPending=FALSE since NONMEM does not cancel pending doses with SS=2</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using sigma from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified atol=1e-12</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified rtol=1e-06</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified ssAtol=1e-12</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0’</span></span></code></pre></div>
<p>Note that since this derived from a <code>nonmem2rx</code> model, the
default solving will match the tolerances and methods specified in your
<code>NONMEM</code> model.</p>
</div>
<div class="section level2">
<h2 id="step-5-exploring-the-simulation-by-plotting-and-summarizing-dplyr">Step 5: Exploring the simulation (by plotting), and summarizing
(dplyr)<a class="anchor" aria-label="anchor" href="#step-5-exploring-the-simulation-by-plotting-and-summarizing-dplyr"></a>
</h2>
<p>This solved object acts the same as any other <code>rxode2</code>
solved object, so you can use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function to see
the individual running AUC profiles you simulated:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span>, <span class="va">AUC</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Running AUC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate-extra-items_files/figure-html/plot-1.png" width="700"></p>
<p>You can also select the points near the dosing to get the AUC for the
interval:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:data.table':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     between, first, last</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="va">s</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11.999</span>,  <span class="fl">23.999</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">time</span>, <span class="va">AUC</span><span class="op">)</span></span>
<span><span class="co">#&gt;    id time       AUC</span></span>
<span><span class="co">#&gt; 1   1   12 14933.285</span></span>
<span><span class="co">#&gt; 2   1   24 20692.082</span></span>
<span><span class="co">#&gt; 3   2   12 11099.596</span></span>
<span><span class="co">#&gt; 4   2   24 16694.837</span></span>
<span><span class="co">#&gt; 5   3   12 10303.763</span></span>
<span><span class="co">#&gt; 6   3   24 14196.023</span></span>
<span><span class="co">#&gt; 7   4   12 13015.708</span></span>
<span><span class="co">#&gt; 8   4   24 21400.784</span></span>
<span><span class="co">#&gt; 9   5   12 11612.369</span></span>
<span><span class="co">#&gt; 10  5   24 17944.491</span></span>
<span><span class="co">#&gt; 11  6   12 10137.247</span></span>
<span><span class="co">#&gt; 12  6   24 15223.973</span></span>
<span><span class="co">#&gt; 13  7   12 16532.019</span></span>
<span><span class="co">#&gt; 14  7   24 22787.019</span></span>
<span><span class="co">#&gt; 15  8   12 10612.266</span></span>
<span><span class="co">#&gt; 16  8   24 16781.396</span></span>
<span><span class="co">#&gt; 17  9   12 11593.421</span></span>
<span><span class="co">#&gt; 18  9   24 17713.529</span></span>
<span><span class="co">#&gt; 19 10   12  7972.637</span></span>
<span><span class="co">#&gt; 20 10   24 13225.795</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Fidler.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
