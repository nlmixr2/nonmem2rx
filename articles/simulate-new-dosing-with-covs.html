<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nonmem2rx">
<title>Simulate New dosing with covariates • nonmem2rx</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate New dosing with covariates">
<meta property="og:description" content="nonmem2rx">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nonmem2rx</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--converting">
    <span class="fa fa-arrow-right"></span>
     
    Converting
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--converting">
    <a class="dropdown-item" href="../articles/import-nonmem.html">Converting NONMEM to rxode2 model</a>
    <a class="dropdown-item" href="../articles/convert-nlmixr2.html">Converting NONMEM to nlmixr2 object</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/rxode2-validate.html">
    <span class="fa fa-check"></span>
     
    Qualify
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--simulation">
    <span class="fa fa-dice"></span>
     
    Simulation
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--simulation">
    <a class="dropdown-item" href="../articles/simulate-new-dosing.html">New Dosing Scenarios</a>
    <a class="dropdown-item" href="../articles/simulate-uncertainty.html">Simulating with Uncertainty</a>
    <a class="dropdown-item" href="../articles/simulate-extra-items.html">Simulating with Derived Variables</a>
    <a class="dropdown-item" href="../articles/simulate-new-dosing-with-covs.html">Simulating with Covariates/Input PK parameters</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reporting">Reporting</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reporting">
    <a class="dropdown-item" href="../articles/create-office.html">Creating word and powerpoint documents</a>
    <a class="dropdown-item" href="../articles/create-vpc.html">Easily create VPC plots</a>
    <a class="dropdown-item" href="../articles/create-augPred.html">Create enriched Individual plots</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/read-rounding.html">
    <span class="fa fa-bug"></span>
     
    Debug
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fas fa fas fa-rss"></span>
     
    News
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/nlmixr2/nonmem2rx/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Simulate New dosing with covariates</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixr2/nonmem2rx/blob/HEAD/vignettes/simulate-new-dosing-with-covs.Rmd" class="external-link"><code>vignettes/simulate-new-dosing-with-covs.Rmd</code></a></small>
      <div class="d-none name"><code>simulate-new-dosing-with-covs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="simulation-with-covariates-or-input-parameters">Simulation with covariates or input parameters<a class="anchor" aria-label="anchor" href="#simulation-with-covariates-or-input-parameters"></a>
</h2>
<p>Sometimes your NONMEM model can have covariates that you may wish to
simulate from; this simulation exercise shows a few methods to simulate
with the covariates from NONMEM.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/nonmem2rx/" class="external-link">nonmem2rx</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixr2.github.io/rxode2/" class="external-link">rxode2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-0-input-the-model">Step 0: input the model<a class="anchor" aria-label="anchor" href="#step-0-input-the-model"></a>
</h2>
<p>In this case, we will use the Friberg myelosuppresion model
originally contributed as an example by Yuan Xiong.</p>
<p>With the simulated data in nlmixr2, babelmixr2, and some manual edits
to simplify the model we run NONMEM 7.4.3.</p>
<p>Note in this case there are some PK parameters that are in the model
that require some special handling to simulate with uncertainty or even
with different dosing scenarios.</p>
<p>For any simulation scenario, we need to import the NONMEM model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Since this is an included example, we import the model from the</span></span>
<span><span class="co"># `nonmem2rx` package.  This is done by the `system.file()` command:</span></span>
<span><span class="va">wbcModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"wbc/wbc.lst"</span>, package<span class="op">=</span><span class="st">"nonmem2rx"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nonmem2rx.html">nonmem2rx</a></span><span class="op">(</span><span class="va">wbcModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> getting information from  '/home/runner/work/_temp/Library/nonmem2rx/wbc/wbc.lst'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading in xml file</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading in phi file</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> reading in lst file</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> abbreviated list parsing</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> splitting control stream by records</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $INPUT</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $MODEL</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $THETA</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $OMEGA</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $SIGMA</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $PROBLEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $DATA</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $SUBROUTINES</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $PK</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $DES</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $ERROR</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $ESTIMATION</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Ignore record $ESTIMATION</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $COVARIANCE</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Ignore record $COVARIANCE</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Processing record $TABLE</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta1` to `1.83169895537931`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta2` to `8.37329670479077`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta3` to `6.37739634773425`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta4` to `-11.558011558`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `theta5` to `0.464650000001741`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `eta1` to `0.0979049999946534`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `eta2` to `2.99999999999372e-06`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> change initial estimate of `eta3` to `1.99999999999944e-05`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> read in nonmem input data (for model validation): /home/runner/work/_temp/Library/nonmem2rx/wbc/wbc.csv</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> ignoring lines that begin with a letter (IGNORE=@)'</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> applying names specified by $INPUT</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> read in nonmem IPRED data (for model validation): /home/runner/work/_temp/Library/nonmem2rx/wbc/wbc.pred</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> read in nonmem ETA data (for model validation): /home/runner/work/_temp/Library/nonmem2rx/wbc/wbc.eta</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> changing most variables to lower case</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> replace theta names</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> replace eta names</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> renaming compartments</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; using C compiler: ‘gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0’</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> solving ipred problem</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> solving pred problem</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> done</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">wbc</span><span class="op">)</span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">rxode2-based free-form 7-cmt ODE model</span> <span style="color: #00BBBB;">──────────────────────────────────────</span> </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Initalization:</span> ──  </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Fixed Effects</span> (<span style="color: #0000BB; font-weight: bold;">$theta</span>): </span></span>
<span><span class="co">#&gt;  log_CIRC0    log_MTT  log_SLOPU  log_GAMMA   prop.err </span></span>
<span><span class="co">#&gt;   1.831699   8.373297   6.377396 -11.558012   0.464650 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Omega</span> (<span style="color: #0000BB; font-weight: bold;">$omega</span>): </span></span>
<span><span class="co">#&gt;           eta.CIRC0 eta.MTT eta.SLOPU</span></span>
<span><span class="co">#&gt; eta.CIRC0  0.097905   0e+00     0e+00</span></span>
<span><span class="co">#&gt; eta.MTT    0.000000   3e-06     0e+00</span></span>
<span><span class="co">#&gt; eta.SLOPU  0.000000   0e+00     2e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co"><span style="font-weight: bold;">#&gt; States</span> (<span style="color: #0000BB; font-weight: bold;">$state</span> or <span style="color: #0000BB; font-weight: bold;">$stateDf</span>): </span></span>
<span><span class="co">#&gt;   Compartment Number Compartment Name</span></span>
<span><span class="co">#&gt; 1                  1            CENTR</span></span>
<span><span class="co">#&gt; 2                  2           PERIPH</span></span>
<span><span class="co">#&gt; 3                  3             PROL</span></span>
<span><span class="co">#&gt; 4                  4              TR1</span></span>
<span><span class="co">#&gt; 5                  5              TR2</span></span>
<span><span class="co">#&gt; 6                  6              TR3</span></span>
<span><span class="co">#&gt; 7                  7           c.CIRC</span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">Model (Normalized Syntax):</span> ── </span></span>
<span><span class="co">#&gt; function() {</span></span>
<span><span class="co">#&gt;     description &lt;- "wbc"</span></span>
<span><span class="co">#&gt;     dfObs &lt;- 176</span></span>
<span><span class="co">#&gt;     dfSub &lt;- 45</span></span>
<span><span class="co">#&gt;     sigma &lt;- lotri({</span></span>
<span><span class="co">#&gt;         eps1 ~ 1</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     thetaMat &lt;- lotri({</span></span>
<span><span class="co">#&gt;         log_CIRC0 + log_MTT + log_SLOPU + log_GAMMA + prop.err + </span></span>
<span><span class="co">#&gt;             eps1 + eta.CIRC0 + omega.2.1 + eta.MTT + omega.3.1 + </span></span>
<span><span class="co">#&gt;             omega.3.2 + eta.SLOPU ~ c(0.00339803, -0.00171728, </span></span>
<span><span class="co">#&gt;             0.00224653, -0.00142939, 0.00545118, 0.0311551, 0.0107932, </span></span>
<span><span class="co">#&gt;             -0.0333153, -0.18915, 3.18077, 8.44599e-05, -0.000185993, </span></span>
<span><span class="co">#&gt;             -0.00110008, 0.0241601, 0.000189655, 0, 0, 0, 0, </span></span>
<span><span class="co">#&gt;             0, 0, -0.00103234, 0.00125366, 0.00108067, 0.000599458, </span></span>
<span><span class="co">#&gt;             3.39316e-05, 0, 0.000977024, 0, 0, 0, 0, 0, 0, 0, </span></span>
<span><span class="co">#&gt;             0, 5.9718e-08, -5.65051e-08, 6.21392e-09, 8.42426e-07, </span></span>
<span><span class="co">#&gt;             6.68526e-09, 0, -5.00488e-08, 0, 7.54658e-12, 0, </span></span>
<span><span class="co">#&gt;             0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, </span></span>
<span><span class="co">#&gt;             0, 0, 0, 3.70943e-07, -1.8945e-07, 1.25175e-06, -1.7346e-06, </span></span>
<span><span class="co">#&gt;             1.59707e-09, 0, -3.13414e-07, 0, 5.308e-11, 0, 0, </span></span>
<span><span class="co">#&gt;             4.20267e-10)</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     validation &lt;- c("IPRED relative difference compared to Nonmem IPRED: 0%; 95% percentile: (0%,0%); rtol=7.82e-11", </span></span>
<span><span class="co">#&gt;         "IPRED absolute difference compared to Nonmem IPRED: 95% percentile: (4.96e-11, 1.28e-06); atol=5.24e-10", </span></span>
<span><span class="co">#&gt;         "PRED relative difference compared to Nonmem PRED: 0%; 95% percentile: (0%,0%); rtol=6.72e-11", </span></span>
<span><span class="co">#&gt;         "PRED absolute difference compared to Nonmem PRED: 95% percentile: (1.4e-11,4.89e-05) atol=6.72e-11")</span></span>
<span><span class="co">#&gt;     ini({</span></span>
<span><span class="co">#&gt;         log_CIRC0 &lt;- 1.83169895537931</span></span>
<span><span class="co">#&gt;         label("1 - log_CIRC0")</span></span>
<span><span class="co">#&gt;         log_MTT &lt;- 8.37329670479077</span></span>
<span><span class="co">#&gt;         label("2 - log_MTT")</span></span>
<span><span class="co">#&gt;         log_SLOPU &lt;- 6.37739634773425</span></span>
<span><span class="co">#&gt;         label("3 - log_SLOPU")</span></span>
<span><span class="co">#&gt;         log_GAMMA &lt;- -11.558011558</span></span>
<span><span class="co">#&gt;         label("4 - log_GAMMA")</span></span>
<span><span class="co">#&gt;         prop.err &lt;- c(0, 0.464650000001741)</span></span>
<span><span class="co">#&gt;         label("5 - prop.err")</span></span>
<span><span class="co">#&gt;         eta.CIRC0 ~ 0.0979049999946534</span></span>
<span><span class="co">#&gt;         eta.MTT ~ 2.99999999999372e-06</span></span>
<span><span class="co">#&gt;         eta.SLOPU ~ 1.99999999999944e-05</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     model({</span></span>
<span><span class="co">#&gt;         cmt(CENTR)</span></span>
<span><span class="co">#&gt;         cmt(PERIPH)</span></span>
<span><span class="co">#&gt;         cmt(PROL)</span></span>
<span><span class="co">#&gt;         cmt(TR1)</span></span>
<span><span class="co">#&gt;         cmt(TR2)</span></span>
<span><span class="co">#&gt;         cmt(TR3)</span></span>
<span><span class="co">#&gt;         cmt(c.CIRC)</span></span>
<span><span class="co">#&gt;         mu_1 &lt;- log_CIRC0</span></span>
<span><span class="co">#&gt;         mu_2 &lt;- log_MTT</span></span>
<span><span class="co">#&gt;         mu_3 &lt;- log_SLOPU</span></span>
<span><span class="co">#&gt;         circ0 &lt;- exp(mu_1 + eta.CIRC0)</span></span>
<span><span class="co">#&gt;         mtt &lt;- exp(mu_2 + eta.MTT)</span></span>
<span><span class="co">#&gt;         slopu &lt;- exp(mu_3 + eta.SLOPU)</span></span>
<span><span class="co">#&gt;         gamma &lt;- exp(log_GAMMA)</span></span>
<span><span class="co">#&gt;         rxini.rxddta3. &lt;- circ0</span></span>
<span><span class="co">#&gt;         PROL(0) &lt;- rxini.rxddta3.</span></span>
<span><span class="co">#&gt;         rxini.rxddta4. &lt;- circ0</span></span>
<span><span class="co">#&gt;         TR1(0) &lt;- rxini.rxddta4.</span></span>
<span><span class="co">#&gt;         rxini.rxddta5. &lt;- circ0</span></span>
<span><span class="co">#&gt;         TR2(0) &lt;- rxini.rxddta5.</span></span>
<span><span class="co">#&gt;         rxini.rxddta6. &lt;- circ0</span></span>
<span><span class="co">#&gt;         TR3(0) &lt;- rxini.rxddta6.</span></span>
<span><span class="co">#&gt;         rxini.rxddta7. &lt;- circ0</span></span>
<span><span class="co">#&gt;         c.CIRC(0) &lt;- rxini.rxddta7.</span></span>
<span><span class="co">#&gt;         cl &lt;- CLI</span></span>
<span><span class="co">#&gt;         v1 &lt;- V1I</span></span>
<span><span class="co">#&gt;         v2 &lt;- V2I</span></span>
<span><span class="co">#&gt;         RXR1 &lt;- 204</span></span>
<span><span class="co">#&gt;         conc &lt;- CENTR/v1</span></span>
<span><span class="co">#&gt;         NN &lt;- 3</span></span>
<span><span class="co">#&gt;         ktr &lt;- (NN + 1)/mtt</span></span>
<span><span class="co">#&gt;         edrug &lt;- 1 - slopu * conc</span></span>
<span><span class="co">#&gt;         fdbk &lt;- (circ0/c.CIRC)^gamma</span></span>
<span><span class="co">#&gt;         circ &lt;- c.CIRC</span></span>
<span><span class="co">#&gt;         d/dt(CENTR) &lt;- PERIPH * RXR1/v2 - CENTR * (cl/v1 + RXR1/v1)</span></span>
<span><span class="co">#&gt;         d/dt(PERIPH) &lt;- CENTR * RXR1/v1 - PERIPH * RXR1/v2</span></span>
<span><span class="co">#&gt;         d/dt(PROL) &lt;- ktr * PROL * edrug * fdbk - ktr * PROL</span></span>
<span><span class="co">#&gt;         d/dt(TR1) &lt;- ktr * PROL - ktr * TR1</span></span>
<span><span class="co">#&gt;         d/dt(TR2) &lt;- ktr * TR1 - ktr * TR2</span></span>
<span><span class="co">#&gt;         d/dt(TR3) &lt;- ktr * TR2 - ktr * TR3</span></span>
<span><span class="co">#&gt;         d/dt(c.CIRC) &lt;- ktr * TR3 - ktr * c.CIRC</span></span>
<span><span class="co">#&gt;         f &lt;- CENTR</span></span>
<span><span class="co">#&gt;         ipred &lt;- c.CIRC</span></span>
<span><span class="co">#&gt;         w &lt;- sqrt((ipred * prop.err)^2)</span></span>
<span><span class="co">#&gt;         if (w == 0) </span></span>
<span><span class="co">#&gt;             w &lt;- 1</span></span>
<span><span class="co">#&gt;         y &lt;- ipred + w * eps1</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">nonmem2rx translation notes (</span><span style="color: #0000BB; font-weight: bold;">$notes</span><span style="font-weight: bold;">):</span> ──  </span></span>
<span><span class="co">#&gt;    • some NONMEM input has tied times; they are offset by a small offset </span></span>
<span><span class="co">#&gt;    • $MODEL NCOMPARTMENTS/NEQUILIBRIUM/NPARAMETERS statement(s) ignored </span></span>
<span><span class="co">#&gt;  ── <span style="font-weight: bold;">nonmem2rx extra properties:</span> ──  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Sigma</span> (<span style="color: #0000BB; font-weight: bold;">$sigma</span>): </span></span>
<span><span class="co">#&gt;      eps1</span></span>
<span><span class="co">#&gt; eps1    1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other properties include: <span style="color: #0000BB; font-weight: bold;">$nonmemData</span>, <span style="color: #0000BB; font-weight: bold;">$etaData</span></span></span>
<span><span class="co">#&gt; captured NONMEM table outputs: <span style="color: #0000BB; font-weight: bold;">$predData</span>, <span style="color: #0000BB; font-weight: bold;">$ipredData</span></span></span>
<span><span class="co">#&gt; NONMEM/rxode2 comparison data: <span style="color: #0000BB; font-weight: bold;">$iwresCompare</span>, <span style="color: #0000BB; font-weight: bold;">$predCompare</span>, <span style="color: #0000BB; font-weight: bold;">$ipredCompare</span></span></span>
<span><span class="co">#&gt; NONMEM/rxode2 composite comparison: <span style="color: #0000BB; font-weight: bold;">$predAtol</span>, <span style="color: #0000BB; font-weight: bold;">$predRtol</span>, <span style="color: #0000BB; font-weight: bold;">$ipredAtol</span>, <span style="color: #0000BB; font-weight: bold;">$ipredRtol</span>, <span style="color: #0000BB; font-weight: bold;">$iwresAtol</span>, <span style="color: #0000BB; font-weight: bold;">$iwresRtol</span></span></span>
<span></span>
<span><span class="co"># note the NONMEM vs rxode2 models validate well. You can see this in</span></span>
<span><span class="co"># the validation code:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">wbc</span><span class="op">$</span><span class="va">meta</span><span class="op">$</span><span class="va">validation</span>, collapse<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; IPRED relative difference compared to Nonmem IPRED: 0%; 95% percentile: (0%,0%); rtol=7.82e-11</span></span>
<span><span class="co">#&gt; IPRED absolute difference compared to Nonmem IPRED: 95% percentile: (4.96e-11, 1.28e-06); atol=5.24e-10</span></span>
<span><span class="co">#&gt; PRED relative difference compared to Nonmem PRED: 0%; 95% percentile: (0%,0%); rtol=6.72e-11</span></span>
<span><span class="co">#&gt; PRED absolute difference compared to Nonmem PRED: 95% percentile: (1.4e-11,4.89e-05) atol=6.72e-11</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="option-1-simulate-with-the-same-conditions-as-the-input-model">Option #1: simulate with the same conditions as the input model<a class="anchor" aria-label="anchor" href="#option-1-simulate-with-the-same-conditions-as-the-input-model"></a>
</h2>
<p>The easiest way to simulate with uncertainty is to use the original
NONMEM input dataset. If we want to simulate covariates from here, we
simply add <code>resample=TRUE</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">wbc</span>, resample<span class="op">=</span><span class="cn">TRUE</span>, nStud<span class="op">=</span><span class="fl">500</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using nocb interpolation like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using addlKeepsCov=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using addlDropSs=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using ssAtDoseTime=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using safeZero=FALSE since NONMEM does not use protection by default</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using ss2cancelAllPending=FALSE since NONMEM does not cancel pending doses with SS=2</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using dfSub=45 from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using dfObs=176 from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using thetaMat from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using sigma from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM's data for solving</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified atol=1e-12</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified rtol=1e-06</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified ssAtol=1e-12</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> thetaMat has too many items, ignored: 'omega.2.1', 'omega.3.1', 'omega.3.2'</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:00:05</span></span>
<span><span class="co">#&gt; Warning: corrected 'thetaMat' to be a symmetric, positive definite matrix</span></span></code></pre></div>
<p>In this case every individual re-samples from the original dataset’s
covariates. In this particular case, the dosing changes per individual
and it may not be what you wish to share with the team but may be a way
to see how the model is performing relative to the data. Binning may be
necessary, as with a typical <code>VPC</code></p>
</div>
<div class="section level2">
<h2 id="option-2-simulate-with-a-different-condition-with-resampled-pk-parameterscovariates">Option 2: simulate with a different condition (with resampled PK
parameters/covariates)<a class="anchor" aria-label="anchor" href="#option-2-simulate-with-a-different-condition-with-resampled-pk-parameterscovariates"></a>
</h2>
<p>In this case, you may wish to simulate a study that has similar
covariates as the NONMEM model in general (and also with resampling)</p>
<p>First lets simulate <code>410</code> every 20 days. We can easily add
this by creating a event table with the same input PK parameters as the
NONMEM dataset.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first create the base event table with the nubmer of individuals</span></span>
<span><span class="co"># matching the NONMEM dataset:</span></span>
<span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html" class="external-link">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">410</span>, ii<span class="op">=</span><span class="fl">20</span><span class="op">*</span><span class="fl">24</span>, until<span class="op">=</span><span class="fl">365</span><span class="op">*</span><span class="fl">24</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Add dosing 20 days apart for a year</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html" class="external-link">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">365</span><span class="op">*</span><span class="fl">24</span>, by<span class="op">=</span><span class="fl">7</span><span class="op">*</span><span class="fl">24</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Assume weekly observations</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html" class="external-link">et</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">wbc</span><span class="op">$</span><span class="va">nonmemData</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Match the number of subjects modeled</span></span>
<span>  <span class="va">as.data.frame</span> <span class="co"># convert to data.frame</span></span>
<span></span>
<span><span class="co"># Now create the PK covariates</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:data.table':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     between, first, last</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="va">pkCov</span> <span class="op">&lt;-</span> <span class="va">wbc</span><span class="op">$</span><span class="va">nonmemData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># only get one observation per id</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">CLI</span>, <span class="va">V1I</span>, <span class="va">V2I</span><span class="op">)</span> <span class="co"># select the covariates</span></span>
<span></span>
<span><span class="va">pkCov</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkCov</span><span class="op">$</span><span class="va">CLI</span><span class="op">)</span> <span class="co"># add the covariates per id</span></span>
<span></span>
<span><span class="co"># Then merge the PK covariates to the original event table</span></span>
<span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">pkCov</span>, <span class="va">ev</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Last simulate with replacement with the new data frame</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">wbc</span>, <span class="va">ev</span>, resample<span class="op">=</span><span class="cn">TRUE</span>, nStud<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using nocb interpolation like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using addlKeepsCov=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using addlDropSs=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using ssAtDoseTime=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using safeZero=FALSE since NONMEM does not use protection by default</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using ss2cancelAllPending=FALSE since NONMEM does not cancel pending doses with SS=2</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using dfSub=45 from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using dfObs=176 from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using thetaMat from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using sigma from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified atol=1e-12</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified rtol=1e-06</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified ssAtol=1e-12</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> thetaMat has too many items, ignored: 'omega.2.1', 'omega.3.1', 'omega.3.2'</span></span>
<span><span class="co">#&gt; Warning: corrected 'thetaMat' to be a symmetric, positive definite matrix</span></span>
<span></span>
<span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; summarizing data...</span></span>
<span><span class="co">#&gt; done</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ci</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate-new-dosing-with-covs_files/figure-html/simCovUncertainty2-1.png" width="700"></p>
<p>This may be closer a constant theoretical dosing regimen you may wish
to explore.</p>
</div>
<div class="section level2">
<h2 id="option-3-simulate-a-larger-study-with-a-different-condition-resampled-pk-parameterscovariates">Option 3: simulate a larger study with a different condition
(resampled PK parameters/covariates)<a class="anchor" aria-label="anchor" href="#option-3-simulate-a-larger-study-with-a-different-condition-resampled-pk-parameterscovariates"></a>
</h2>
<p>Another option is to create a larger dataset (that is a multiple of
the original dataset). In this case, I will assume that the new study
will have <code>225</code> patients, which is a <code>5</code> fold
increase in subjects compared to the NONMEM input.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first create the base event table with the nubmer of individuals</span></span>
<span><span class="co"># matching the NONMEM dataset:</span></span>
<span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html" class="external-link">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">410</span>, ii<span class="op">=</span><span class="fl">20</span><span class="op">*</span><span class="fl">24</span>, until<span class="op">=</span><span class="fl">365</span><span class="op">*</span><span class="fl">24</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Add dosing 20 days apart for a year</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html" class="external-link">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">365</span><span class="op">*</span><span class="fl">24</span>, by<span class="op">=</span><span class="fl">7</span><span class="op">*</span><span class="fl">24</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Assume weekly observations</span></span>
<span>  <span class="fu"><a href="https://nlmixr2.github.io/rxode2et/reference/et.html" class="external-link">et</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">wbc</span><span class="op">$</span><span class="va">nonmemData</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Match the number of subjects modeled</span></span>
<span>  <span class="va">as.data.frame</span> <span class="co"># convert to data.frame</span></span>
<span></span>
<span><span class="co"># Now create the PK covariates</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pkCov</span> <span class="op">&lt;-</span> <span class="va">wbc</span><span class="op">$</span><span class="va">nonmemData</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># only get one observation per id</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">CLI</span>, <span class="va">V1I</span>, <span class="va">V2I</span><span class="op">)</span> <span class="co"># select the covariates</span></span>
<span></span>
<span><span class="co"># expand the covariates by 5</span></span>
<span></span>
<span><span class="va">pkCov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>                   <span class="va">pkCov</span></span>
<span>                 <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">pkCov</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">pkCov</span><span class="op">$</span><span class="va">CLI</span><span class="op">)</span> <span class="co"># add the covariates per id</span></span>
<span></span>
<span><span class="co"># Then merge the PK covariates to the original event table</span></span>
<span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">pkCov</span>, <span class="va">ev</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Last simulate with replacement with the new data frame</span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://nlmixr2.github.io/rxode2/reference/rxSolve.html" class="external-link">rxSolve</a></span><span class="op">(</span><span class="va">wbc</span>, <span class="va">ev</span>, resample<span class="op">=</span><span class="cn">TRUE</span>, nStud<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using nocb interpolation like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using addlKeepsCov=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using addlDropSs=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using ssAtDoseTime=TRUE like NONMEM, specify directly to change</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using safeZero=FALSE since NONMEM does not use protection by default</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using ss2cancelAllPending=FALSE since NONMEM does not cancel pending doses with SS=2</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using dfSub=45 from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using dfObs=176 from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using thetaMat from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using sigma from NONMEM</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified atol=1e-12</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified rtol=1e-06</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> using NONMEM specified ssAtol=1e-12</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> thetaMat has too many items, ignored: 'omega.2.1', 'omega.3.1', 'omega.3.2'</span></span>
<span><span class="co">#&gt; [====|====|====|====|====|====|====|====|====|====] 0:01:34</span></span>
<span><span class="co">#&gt; Warning: corrected 'thetaMat' to be a symmetric, positive definite matrix</span></span>
<span></span>
<span><span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; summarizing data...</span></span>
<span><span class="co">#&gt; done</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ci</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulate-new-dosing-with-covs_files/figure-html/simUncertanty3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="other-options">Other options<a class="anchor" aria-label="anchor" href="#other-options"></a>
</h2>
<p>You can also simulation without uncertainty and use covariates by
resampling by hand (or even simulating new covariates manually).</p>
<p>I believe that reampling keeps any hidden correlations between
covariates, and should be used whenever possible. At the time of this
writing, resampling can only occur when the new event table is a
multiple of the input dataest. Eventually a feature may be added to
resample from an input dataset directly.</p>
<p>Note that resampling will also work with time-varying covariates. The
time-varying covariates would be imputed based on the input times per
subject.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew Fidler.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
